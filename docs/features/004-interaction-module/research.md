# Research: Real-time Voice Interaction Testing Module

**Date**: 2026-01-19
**Feature**: 004-interaction-module

## æ ¸å¿ƒæ¦‚å¿µï¼šå…©ç¨®äº’å‹•æ¨¡å¼

æœ¬åŠŸèƒ½æ¨¡çµ„å€åˆ†å…©ç¨®æ ¹æœ¬ä¸åŒçš„èªéŸ³äº’å‹•æ¶æ§‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨¡å¼ 1: V2V ç›´é€£æ¨¡å¼ (Voice-to-Voice Direct)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚  [éº¥å…‹é¢¨] â”€â”€â–¶ [Realtime API] â”€â”€â–¶ [å–‡å­]                                      â”‚
â”‚                    â”‚                                                         â”‚
â”‚                    â””â”€â”€ å–®ä¸€ API è™•ç†ï¼šèªéŸ³è¼¸å…¥ â†’ ç†è§£ â†’ èªéŸ³è¼¸å‡º              â”‚
â”‚                                                                              â”‚
â”‚  ç‰¹é»ï¼šæœ€ä½å»¶é²ã€ç«¯å°ç«¯æ•´åˆã€è¼ƒå°‘æ§åˆ¶æ¬Š                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¨¡å¼ 2: æ‹¼è£æ¨¡å¼ (Cascade: STT â†’ LLM â†’ TTS)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚  [éº¥å…‹é¢¨] â”€â”€â–¶ [STT] â”€â”€â–¶ [LLM] â”€â”€â–¶ [TTS] â”€â”€â–¶ [å–‡å­]                          â”‚
â”‚                â”‚         â”‚         â”‚                                         â”‚
â”‚                â”‚         â”‚         â””â”€â”€ å¯é¸æœ€ä½³éŸ³è³ª TTS                      â”‚
â”‚                â”‚         â””â”€â”€ å¯é¸æœ€ä½³ LLM                                    â”‚
â”‚                â””â”€â”€ å¯é¸æœ€ä½³ STT                                               â”‚
â”‚                                                                              â”‚
â”‚  ç‰¹é»ï¼šé«˜å“è³ªéŸ³æ•ˆã€éˆæ´»çµ„åˆã€å®Œå…¨æ§åˆ¶ã€å»¶é²è¼ƒé«˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. V2V ç›´é€£æ¨¡å¼æä¾›è€…

### 1.1 OpenAI Realtime API âœ…

**ç‹€æ…‹**: ç”Ÿç”¢å°±ç·’

| é …ç›® | èªªæ˜ |
|------|------|
| TTFT | ~100-200ms |
| æ¨¡å‹ | gpt-realtime (åŸºæ–¼ GPT-5.2) |
| å®šåƒ¹ | Input: $1.75/1M tokens, Output: $14/1M tokens |

**æŠ€è¡“ç´°ç¯€**:
- WebSocket é€£ç·šï¼š`wss://api.openai.com/v1/realtime?model=gpt-realtime`
- éŸ³è¨Šæ ¼å¼ï¼šPCM16, 16kHz/24kHz
- å…§å»º Server-side VAD
- æ”¯æ´æ‰“æ–· (interrupted äº‹ä»¶)
- 400K context window

**Session é…ç½®**:
```python
{
    "type": "session.update",
    "session": {
        "modalities": ["audio", "text"],
        "voice": "alloy",  # alloy, shimmer, nova, echo, fable, onyx
        "input_audio_format": "pcm16",
        "output_audio_format": "pcm16",
        "turn_detection": {
            "type": "server_vad",
            "threshold": 0.5,
            "prefix_padding_ms": 300,
            "silence_duration_ms": 500
        }
    }
}
```

**é©ç”¨å ´æ™¯**: å»¶é²æ•æ„Ÿçš„å³æ™‚å°è©±ã€OpenAI ç”Ÿæ…‹ç³»çµ±ç”¨æˆ¶

---

### 1.2 Gemini 3 Flash Live API âœ… ğŸ†

**ç‹€æ…‹**: ç”Ÿç”¢å°±ç·’ - **Voice AI é¦–é¸**

| é …ç›® | èªªæ˜ |
|------|------|
| TTFT | ~70-150ms âš¡ (æœ€å¿«) |
| æ¨¡å‹ | gemini-3-flash |
| å®šåƒ¹ | Input: $0.50/1M tokens, Output: $3/1M tokens |

**æŠ€è¡“ç´°ç¯€**:
- WebSocket é€£ç·šï¼šBidiGenerateContent API
- æ”¯æ´ `BidiGenerateContentRealtimeInput` å³æ™‚éŸ³è¨Šä¸²æµ
- é›™å‘éŸ³è¨Šé€šè¨Š
- 1M context window, 64K output tokens
- 218 tokens/sec throughput
- Dynamic Thinking (`thinking_level` åƒæ•¸)

**é—œéµè¨Šæ¯é¡å‹**:
```python
# ç™¼é€éŸ³è¨Š
{
    "realtimeInput": {
        "audio": "base64_encoded_audio_chunk"
    }
}

# æ¥æ”¶å›æ‡‰
{
    "serverContent": {
        "modelTurn": {
            "parts": [{"text": "..."}]  # æˆ–éŸ³è¨Š
        },
        "interrupted": false,
        "turnComplete": true
    }
}
```

**é©ç”¨å ´æ™¯**: å»¶é²å„ªå…ˆã€æ€§åƒ¹æ¯”è€ƒé‡ã€Google ç”Ÿæ…‹ç³»çµ±

---

### 1.3 V2V æ¨¡å¼æ¯”è¼ƒ

| æä¾›è€… | TTFT | æˆæœ¬/æœˆ* | éŸ³è³ª | æ‰“æ–·æ”¯æ´ | æ¨è–¦ |
|--------|------|----------|------|----------|------|
| Gemini 3 Flash | ~70-150ms | ~$255 | â­â­â­â­ | âœ… | ğŸ† å»¶é²+æˆæœ¬ |
| OpenAI Realtime | ~100-200ms | ~$1,110 | â­â­â­â­â­ | âœ… | å“è³ª+ç”Ÿæ…‹ |

*å‡è¨­æ¯æ—¥ 10,000 æ¬¡å°è©±ï¼Œæ¯æ¬¡ 500 input + 200 output tokens

---

## 2. æ‹¼è£æ¨¡å¼ (Cascade) çµ„ä»¶

### 2.1 STT æä¾›è€…

æ ¹æ“šç ”ç©¶æ–‡æª” `02-stt.md`ï¼Œä»¥ä¸‹ç‚ºæ¨è–¦é¸é …ï¼š

| æä¾›è€… | å»¶é² | æº–ç¢ºåº¦ | å®šåƒ¹/hr | ç‰¹è‰² |
|--------|------|--------|---------|------|
| **Deepgram Nova-2** | ~100-200ms | WER 5-8% | ~$0.26 | é€šç”¨é¦–é¸ |
| **AssemblyAI Universal-2** | å³æ™‚ | 93.3% WAR | $0.15 | ğŸ’° æ€§åƒ¹æ¯”æœ€é«˜ |
| **ElevenLabs Scribe v2** | ~150ms | WER 3.1% | $0.40 | ğŸ† æœ€é«˜æº–ç¢ºåº¦ |
| **Speechmatics** | å³æ™‚ | 91.8% (å…’ç«¥) | ä¼æ¥­å®šåƒ¹ | ğŸ‘¶ å…’ç«¥èªéŸ³æœ€ä½³ |

**æ¨è–¦**:
- å»¶é²å„ªå…ˆ: Deepgram Nova-2
- æº–ç¢ºåº¦å„ªå…ˆ: ElevenLabs Scribe
- æˆæœ¬å„ªå…ˆ: AssemblyAI
- å…’ç«¥èªéŸ³: Speechmatics

---

### 2.2 LLM æä¾›è€…

æ ¹æ“šç ”ç©¶æ–‡æª” `03-llm.md`ï¼Œä»¥ä¸‹ç‚ºé©åˆ Cascade æ¨¡å¼çš„ LLMï¼š

| æä¾›è€… | TTFT | å®šåƒ¹ ($/1M) | ç‰¹è‰² |
|--------|------|-------------|------|
| **Gemini 3 Flash** | ~80ms | $0.50 / $3 | ğŸ† æœ€ä½³å¹³è¡¡ |
| **DeepSeek V3.2** | ~120ms | $0.028 / $0.14 | ğŸ’° æ¥µè‡´ä½æˆæœ¬ |
| **Claude 4.5 Haiku** | ~180ms | $1 / $5 | å¿«é€Ÿ + å“è³ª |
| **GPT-5.2 Instant** | ~130ms | $1.75 / $14 | OpenAI ç”Ÿæ…‹ |

**å·²ç¢ºèªæ”¯æ´**: Gemini 3 Flash + OpenAI GPT-4o (æ ¹æ“š /speckit.clarify)

---

### 2.3 TTS æä¾›è€…

æ ¹æ“šç ”ç©¶æ–‡æª” `04-tts.md`ï¼š

| æä¾›è€… | TTFB | MOS | å®šåƒ¹/1K chars | ç‰¹è‰² |
|--------|------|-----|---------------|------|
| **Cartesia Sonic** | ~80ms | 4.2+ | $0.040 | âš¡ å»¶é²æœ€ä½ |
| **ElevenLabs Turbo v2.5** | ~250ms | 4.5+ | $0.18-0.30 | ğŸµ å“è³ªæœ€é«˜ |
| **Deepgram Aura** | ~150ms | 4.0+ | $0.015 | ğŸ’° æœ€ä¾¿å®œ |
| **Azure Neural** | ~350ms | 4.3+ | $15/1M chars | ä¸­æ–‡å„ªç§€ |

**æ¨è–¦**:
- å»¶é²å„ªå…ˆ: Cartesia Sonic
- å“è³ªå„ªå…ˆ: ElevenLabs
- æˆæœ¬å„ªå…ˆ: Deepgram Aura
- ä¸­æ–‡å„ªåŒ–: Azure Neural

---

### 2.4 Cascade æ¨¡å¼å»¶é²åˆ†æ

```
ç†æƒ³å»¶é²é ç®— (< 1 ç§’ç«¯å°ç«¯)ï¼š

ç”¨æˆ¶èªªå®Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ æ’­æ”¾é–‹å§‹
         â”‚ STT     â”‚ LLM TTFT â”‚ TTS TTFB â”‚ Buffer â”‚
         â”‚ ~100ms  â”‚ ~100ms   â”‚ ~80ms    â”‚ ~50ms  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    ç¸½è¨ˆç´„ 330ms (ç†æƒ³çµ„åˆ)
```

**æ¨è–¦çµ„åˆ**:

| å„ªå…ˆç´š | STT | LLM | TTS | é ä¼°å»¶é² | æœˆæˆæœ¬* |
|--------|-----|-----|-----|----------|---------|
| å»¶é² ğŸ† | Deepgram | Gemini 3 Flash | Cartesia | ~350ms | ~$3,500 |
| æˆæœ¬ ğŸ’° | AssemblyAI | DeepSeek V3.2 | Deepgram | ~500ms | ~$800 |
| å“è³ª ğŸµ | ElevenLabs Scribe | Claude 4.5 Haiku | ElevenLabs | ~800ms | ~$15,000 |

*å‡è¨­æ¯æ—¥ 10,000 æ¬¡å°è©±

---

## 3. æ¶æ§‹è¨­è¨ˆæ±ºç­–

### 3.1 å¾Œç«¯ WebSocket ä»£ç†

**Decision**: å‰ç«¯é€éå¾Œç«¯ WebSocket èˆ‡å¤–éƒ¨ API é€šè¨Šï¼Œä¸ç›´æ¥é€£æ¥ã€‚

**Rationale**:
- **å®‰å…¨æ€§**: API æ†‘è­‰ä¿ç•™åœ¨å¾Œç«¯
- **çµ±ä¸€ä»‹é¢**: å‰ç«¯åªéœ€ä¸€å¥—å”è­°
- **å»¶é²è¿½è¹¤**: å¾Œç«¯å¯ç²¾ç¢ºæ¸¬é‡å„éšæ®µå»¶é²
- **Fallback è™•ç†**: å¾Œç«¯å¯è‡ªå‹•åˆ‡æ›æ¨¡å¼

### 3.2 WebSocket å”è­°

**Client â†’ Server è¨Šæ¯**:
```typescript
type ClientMessage =
  | { type: "start_session"; mode: "v2v" | "cascade"; config: SessionConfig }
  | { type: "audio_chunk"; audio: string }  // Base64 PCM16
  | { type: "end_turn" }
  | { type: "interrupt" }
  | { type: "end_session" }
```

**Server â†’ Client è¨Šæ¯**:
```typescript
type ServerMessage =
  | { type: "session_started"; session_id: string; mode: "v2v" | "cascade" }
  | { type: "speech_started" }
  | { type: "speech_ended" }
  | { type: "transcript"; text: string; is_final: boolean }  // Cascade only
  | { type: "response_started" }
  | { type: "audio_chunk"; audio: string }
  | { type: "response_ended"; latency: LatencyMetrics }
  | { type: "interrupted" }
  | { type: "error"; code: string; message: string }
```

---

## 4. å»¶é²æ¸¬é‡ç­–ç•¥

### 4.1 V2V æ¨¡å¼

```
t0: æ”¶åˆ° speech_started
t1: ç™¼é€åˆ° V2V API
t2: æ”¶åˆ°ç¬¬ä¸€å€‹ audio.delta
t3: æ’­æ”¾ç¬¬ä¸€å€‹éŸ³è¨Š chunk

Metrics:
- Total Latency = t3 - t0
- API Latency = t2 - t1
```

### 4.2 Cascade æ¨¡å¼

```
t0: æ”¶åˆ° speech_started
t1: STT é–‹å§‹
t2: æ”¶åˆ°æœ€çµ‚ transcript
t3: LLM é–‹å§‹
t4: æ”¶åˆ°ç¬¬ä¸€å€‹ LLM token
t5: TTS é–‹å§‹
t6: æ”¶åˆ°ç¬¬ä¸€å€‹ audio chunk
t7: æ’­æ”¾é–‹å§‹

Metrics:
- STT Latency = t2 - t1
- LLM TTFT = t4 - t3
- TTS TTFB = t6 - t5
- Total Latency = t7 - t0
```

---

## 5. æ‰“æ–· (Barge-in) å¯¦ä½œ

**ç­–ç•¥**: Server-side VAD + Client ç«¯ç«‹å³åœæ­¢

**V2V æ¨¡å¼**:
- OpenAI: æ”¶åˆ° `interrupted: true` äº‹ä»¶
- Gemini: æ”¶åˆ° `serverContent.interrupted: true`

**Cascade æ¨¡å¼**:
- åµæ¸¬åˆ°æ–°çš„ speech_started â†’ åœæ­¢ TTS æ’­æ”¾
- å–æ¶ˆé€²è¡Œä¸­çš„ LLM/TTS è«‹æ±‚
- é–‹å§‹æ–°çš„è™•ç†é€±æœŸ

---

## 6. ä»‹é¢è¨­è¨ˆå»ºè­°

### æ¨¡å¼é¸æ“‡ UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¸æ“‡äº’å‹•æ¨¡å¼                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ğŸš€ V2V ç›´é€£æ¨¡å¼     â”‚  â”‚  ğŸµ æ‹¼è£æ¨¡å¼         â”‚          â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚          â”‚
â”‚  â”‚  æœ€ä½å»¶é²            â”‚  â”‚  é«˜å“è³ªéŸ³æ•ˆ          â”‚          â”‚
â”‚  â”‚  ç«¯å°ç«¯æ•´åˆ          â”‚  â”‚  éˆæ´»çµ„åˆ            â”‚          â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚          â”‚
â”‚  â”‚  æä¾›è€…:            â”‚  â”‚  STT: [é¸æ“‡]        â”‚          â”‚
â”‚  â”‚  â—‹ OpenAI Realtime  â”‚  â”‚  LLM: [é¸æ“‡]        â”‚          â”‚
â”‚  â”‚  â—‹ Gemini Live ğŸ†   â”‚  â”‚  TTS: [é¸æ“‡]        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Summary

### æ¨¡å¼æ±ºç­–çŸ©é™£

| è€ƒé‡ | V2V ç›´é€£ | Cascade æ‹¼è£ |
|------|----------|--------------|
| å»¶é² | â­â­â­â­â­ | â­â­â­ |
| éŸ³è³ªæ§åˆ¶ | â­â­â­ | â­â­â­â­â­ |
| æˆæœ¬ | å–æ±ºæ–¼æä¾›è€… | å¯å„ªåŒ– |
| éˆæ´»æ€§ | â­â­ | â­â­â­â­â­ |
| å¯¦ä½œè¤‡é›œåº¦ | â­â­â­â­â­ (ç°¡å–®) | â­â­â­ (ä¸­ç­‰) |

### åŠŸèƒ½éœ€æ±‚å°æ‡‰

| éœ€æ±‚ | V2V æ”¯æ´ | Cascade æ”¯æ´ |
|------|----------|--------------|
| FR-002 (Realtime API) | âœ… | - |
| FR-003 (Cascade) | - | âœ… |
| FR-004 (Fallback) | âœ… è‡ªå‹•åˆ‡æ› | âœ… |
| FR-005 (å»¶é²æ¸¬é‡) | âœ… | âœ… (åˆ†æ®µ) |
| FR-007 (æ‰“æ–·) | âœ… åŸç”Ÿ | âœ… éœ€å¯¦ä½œ |

### ç¢ºèªçš„æä¾›è€…

**V2V ç›´é€£æ¨¡å¼**:
- OpenAI Realtime API
- Gemini 3 Flash Live API

**Cascade æ‹¼è£æ¨¡å¼**:
- STT: Phase 3 å·²å¯¦ä½œ (Deepgram, AssemblyAI ç­‰)
- LLM: Gemini + OpenAI GPT-4o (å·²ç¢ºèª)
- TTS: Phase 1 å·²å¯¦ä½œ (Azure, ElevenLabs, Cartesia ç­‰)

**æ‰€æœ‰ç ”ç©¶å•é¡Œå·²è§£æ±º** âœ…
