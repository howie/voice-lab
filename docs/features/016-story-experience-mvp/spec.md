# Feature Specification: MVP Story Experience Interface (父母的故事體驗介面)

**Feature Branch**: `016-story-experience-mvp`
**Created**: 2026-02-12
**Status**: Draft
**Input**: User description: "MVP 測試流程 - 父母的故事體驗介面：父母提供指令/需求 → AI 產出內容 → 現場播放和孩子互動"

## Clarifications

### Session 2026-02-12

- Q: 故事體驗介面是否需要認證？ → A: 使用現有 Google OAuth 認證，由現場工作人員以自己的帳號登入後操作介面
- Q: 父母是否可手動編輯 AI 生成的文字內容？ → A: 可簡單編輯，提供基本文字編輯區（textarea），父母可微調內容後再進行 TTS
- Q: 生成的故事目標長度為何？ → A: 依年齡自動調整 — 2-4 歲短篇（150-300 字，TTS 約 1-2 分鐘）、5-8 歲中篇（300-500 字，TTS 約 2-3 分鐘）、9-12 歲長篇（500-800 字，TTS 約 3-5 分鐘）
- Q: TTS 語音生成使用哪個 provider？ → A: MVP 固定使用 Gemini TTS（系統已有 gemini_tts provider 整合），父母從可用的 Gemini 中文語音中選擇
- Q: 故事內容生成使用哪個 LLM？ → A: 使用 Gemini LLM（系統已有 gemini_llm provider 整合），與 TTS 同一生態系，簡化配置

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 父母輸入參數並生成故事內容 (Priority: P1)

父母在簡易介面上輸入或選擇必要的資訊（孩子年齡、教導內容、價值觀、情緒認知、喜愛角色、內容形式），系統透過 AI 產出符合要求的故事內容。父母可以預覽內容、確認後進入音頻生成流程。

**Why this priority**: 這是 MVP 核心流程的起點。沒有內容生成，後續的 TTS 播放和互動都無法進行。父母能夠快速輸入需求並看到 AI 生成的故事內容，是整個體驗的基礎。

**Independent Test**: 可透過父母在介面上選擇「5 歲、勇氣、快樂情緒、小恐龍、故事」後點擊生成，驗證系統是否在合理時間內產出一段符合年齡和主題的故事文字內容。

**Acceptance Scenarios**:

1. **Given** 父母進入故事體驗頁面，**When** 頁面載入，**Then** 顯示所有必要的輸入欄位（年齡、教導內容、價值觀、情緒認知、喜愛角色、內容形式選擇）
2. **Given** 父母已填寫所有必要欄位，**When** 點擊「生成內容」按鈕，**Then** 系統顯示載入狀態並在完成後展示 AI 生成的故事內容
3. **Given** AI 已生成故事內容，**When** 父母閱讀內容後覺得不滿意，**Then** 可以點擊「重新生成」取得新版本的故事內容
4. **Given** AI 已生成故事內容，**When** 父母確認內容滿意，**Then** 可以點擊「確認並生成音頻」進入 TTS 階段

---

### User Story 2 - 確認後生成 TTS 音頻並播放 (Priority: P1)

父母確認 AI 生成的故事/兒歌內容後，系統使用 TTS 將文字轉為語音，父母可以在現場播放音頻與孩子互動。

**Why this priority**: 音頻播放是 MVP 體驗的最終交付物。父母在現場需要用音頻和孩子互動，這是驗證產品價值的關鍵環節。

**Independent Test**: 可透過確認一段已生成的故事文字，驗證系統能否成功轉換為語音並提供可播放的音頻。

**Acceptance Scenarios**:

1. **Given** 父母已確認故事內容，**When** 點擊「生成音頻」，**Then** 系統使用 TTS 將故事文字轉換為語音，並顯示轉換進度
2. **Given** TTS 轉換完成，**When** 音頻就緒，**Then** 頁面顯示音頻播放器，父母可以播放、暫停、重播音頻
3. **Given** 音頻正在播放，**When** 父母需要停止，**Then** 可以隨時暫停或停止播放
4. **Given** TTS 轉換完成，**When** 父母想要更換聲音風格，**Then** 可以選擇不同的 TTS 語音重新生成音頻

---

### User Story 3 - 生成兒歌內容並播放 (Priority: P2)

父母選擇「兒歌」作為內容形式時，系統生成符合教導內容和價值觀的兒歌歌詞，並透過 TTS 轉換為可播放的音頻。

**Why this priority**: 兒歌是除故事外的另一種重要內容形式，擴展了 MVP 能展示的體驗類型，但核心流程（輸入 → 生成 → 播放）與故事相同。

**Independent Test**: 可透過選擇「兒歌」形式並輸入「分享」作為價值觀，驗證系統生成的兒歌歌詞是否包含分享的概念且適合目標年齡。

**Acceptance Scenarios**:

1. **Given** 父母選擇「兒歌」作為內容形式，**When** 填入教導內容和價值觀後點擊生成，**Then** 系統產出具有歌詞結構（段落、重複句）的兒歌內容
2. **Given** 兒歌歌詞已生成，**When** 父母確認後生成音頻，**Then** TTS 以適合兒歌的語調和節奏朗讀歌詞

---

### User Story 4 - 故事走向選擇（分支故事）(Priority: P2)

在故事生成過程中，系統提供 2-3 個故事走向選項，父母可以選擇偏好的方向讓 AI 繼續發展故事，創造個性化的故事體驗。

**Why this priority**: 故事走向選擇增加了互動性和個性化，讓父母感受到產品不只是單向輸出，而是可以引導故事方向。這是區別於普通故事生成器的重要體驗。

**Independent Test**: 可在故事生成後，驗證系統是否提供故事走向選項，且選擇後能產出延續該走向的新內容。

**Acceptance Scenarios**:

1. **Given** 一段故事已生成完畢，**When** 父母想要延伸故事，**Then** 系統顯示 2-3 個故事走向選項供選擇
2. **Given** 父母選擇了一個故事走向，**When** 點擊該選項，**Then** AI 基於選定的走向生成後續故事段落
3. **Given** 後續故事已生成，**When** 父母想繼續延伸，**Then** 可以重複進行走向選擇和內容生成

---

### User Story 5 - 故事 Q&A 互動（問答環節）(Priority: P3)

父母可以基於已生成的故事內容，啟動 Q&A 模式。系統根據故事內容生成適合孩子年齡的問題，或父母可以輸入自訂問題，AI 根據故事脈絡產出回答。

**Why this priority**: Q&A 互動是進階功能，讓故事不只是被動聆聽，更能促進孩子的思考和理解。但它需要故事內容作為基礎，屬於附加價值。

**Independent Test**: 可在一段故事生成後啟動 Q&A 模式，驗證系統能否產出與故事內容相關的問答。

**Acceptance Scenarios**:

1. **Given** 一段故事已生成，**When** 父母點擊「Q&A 互動」按鈕，**Then** 系統基於故事內容自動生成 2-3 個適合孩子年齡的思考問題
2. **Given** Q&A 模式已啟動，**When** 父母選擇一個問題或輸入自訂問題，**Then** 系統產出適合孩子理解的回答
3. **Given** Q&A 回答已生成，**When** 父母確認回答內容，**Then** 可以生成該問答的 TTS 音頻進行播放

---

### Edge Cases

- **EC-001 AI 生成失敗**：當 AI 內容生成因網路或 API 錯誤失敗時，系統顯示友善的錯誤訊息並提供「重試」按鈕，不遺失已填入的輸入參數。
- **EC-002 TTS 轉換失敗**：當 TTS 音頻生成失敗時，系統保留已確認的文字內容，顯示錯誤訊息並允許重試或選擇不同的 TTS 語音重新嘗試。
- **EC-003 內容不適當**：若 AI 產出的內容偶發性包含不適合兒童的用語，系統依賴 prompt 約束確保內容安全，父母在確認步驟可進行把關。
- **EC-004 長文字 TTS 限制**：當故事內容超過 TTS 服務的單次處理上限時，系統自動將內容分段處理並依序拼接音頻。
- **EC-005 表單未完整填寫**：當父母未填寫所有必要欄位就嘗試生成時，系統標示缺漏欄位並提示補充。
- **EC-006 重新生成與歷史**：當父母多次重新生成時，系統保留最近一次生成的內容，不保留歷史版本（MVP 簡化設計）。

## Requirements *(mandatory)*

### Functional Requirements

**輸入參數介面**

- **FR-001**: 系統 MUST 提供「年齡」選擇欄位，支援 2-12 歲的年齡範圍選擇
- **FR-002**: 系統 MUST 提供「教導內容」文字輸入欄位，允許父母以自然語言描述希望教導的內容（如：認識顏色、學習數數、認識動物）
- **FR-003**: 系統 MUST 提供「價值觀」選擇欄位，以預設選項方式供父母選擇（如：勇氣、善良、分享、誠實、尊重、感恩、合作、耐心），支援多選
- **FR-004**: 系統 MUST 提供「情緒認知」選擇欄位，以預設選項供父母選擇目標情緒學習（如：快樂、悲傷、憤怒、恐懼、驚訝、同理心），支援多選
- **FR-005**: 系統 MUST 提供「喜愛角色」文字輸入欄位，允許父母輸入孩子喜歡的角色（如：小恐龍、公主、太空人、小貓咪）
- **FR-006**: 系統 MUST 提供「內容形式」選擇欄位，支援以下選項：故事、兒歌
- **FR-007**: 系統 MUST 對所有必填欄位進行驗證，未填寫時顯示提示並阻止提交

**AI 內容生成**

- **FR-008**: 系統 MUST 根據父母輸入的參數，透過 Gemini LLM 生成符合要求的故事或兒歌內容
- **FR-009**: 系統 MUST 確保生成的內容使用繁體中文，且詞彙和句式符合所選年齡層的理解能力
- **FR-009a**: 系統 MUST 依孩子年齡自動調整生成內容長度：2-4 歲短篇（150-300 字）、5-8 歲中篇（300-500 字）、9-12 歲長篇（500-800 字）
- **FR-010**: 系統 MUST 在內容生成過程中顯示載入狀態指示
- **FR-011**: 系統 MUST 在故事內容中自然融入所選的價值觀和情緒認知元素
- **FR-012**: 系統 MUST 在故事內容中使用父母指定的喜愛角色作為故事主角或重要角色
- **FR-013**: 系統 MUST 支援「重新生成」功能，基於相同參數產出不同版本的內容

**內容預覽與確認**

- **FR-014**: 系統 MUST 在生成完成後以可編輯的文字區域（textarea）展示內容，允許父母微調文字後再確認
- **FR-015**: 系統 MUST 提供「確認」和「重新生成」兩個操作按鈕
- **FR-016**: 系統 MUST 在內容預覽區域顯示生成時使用的參數摘要（年齡、價值觀等），方便父母確認

**TTS 音頻生成**

- **FR-017**: 系統 MUST 在父母確認內容後，使用 TTS 服務將文字內容轉換為語音音頻
- **FR-018**: 系統 MUST 使用 Gemini TTS provider 進行語音合成，並提供可用的 Gemini 中文語音選項供父母選擇（至少 2 種）
- **FR-019**: 系統 MUST 在 TTS 轉換過程中顯示進度指示
- **FR-020**: 系統 MUST 在音頻生成完成後提供播放控制（播放、暫停、重播）

**故事走向選擇**

- **FR-021**: 系統 MUST 在故事生成後提供「延伸故事」入口
- **FR-022**: 系統 MUST 生成 2-3 個故事走向選項，每個選項包含簡短描述
- **FR-023**: 系統 MUST 根據父母選擇的走向，基於前文脈絡生成後續故事段落
- **FR-024**: 系統 MUST 將延伸後的完整故事內容合併顯示，支援整體 TTS 生成

**故事 Q&A 互動**

- **FR-025**: 系統 MUST 基於已生成的故事內容，自動產出 2-3 個適合目標年齡的思考問題
- **FR-026**: 系統 MUST 支援父母輸入自訂問題
- **FR-027**: 系統 MUST 根據故事脈絡和問題，生成適合孩子年齡的回答內容
- **FR-028**: 系統 MUST 支援將 Q&A 問答內容進行 TTS 音頻生成

### Key Entities

- **StoryRequest（故事生成請求）**: 代表一次內容生成的輸入參數集合，包含年齡、教導內容、價值觀、情緒認知、喜愛角色、內容形式。
- **GeneratedContent（生成內容）**: 代表 AI 生成的內容結果，包含文字內容、內容類型（故事/兒歌）、使用的參數摘要、生成時間。可進一步延伸（走向選擇）或附加 Q&A。
- **StoryBranch（故事分支）**: 代表一個故事走向選項，包含簡短描述和選擇後的延續內容。
- **QAItem（問答項目）**: 代表一組問答，包含問題文字、回答文字、是否為系統自動生成或父母自訂。
- **AudioOutput（音頻輸出）**: 代表 TTS 生成的音頻結果，關聯到一個 GeneratedContent，包含語音選擇、音頻資料、時長。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 父母從開始填寫參數到看到生成的故事/兒歌內容，整個流程可在 2 分鐘內完成
- **SC-002**: 生成的故事內容符合所選年齡層的詞彙難度（由現場測試人員主觀評估）
- **SC-003**: 生成的內容包含父母選擇的價值觀和情緒認知元素（可從內容中明確識別）
- **SC-004**: 從內容確認到 TTS 音頻可播放，等待時間不超過 30 秒（中等長度故事約 300-500 字）
- **SC-005**: 在 MVP 現場測試中，80% 以上的父母能在無額外指導的情況下完成「輸入 → 生成 → 播放」完整流程
- **SC-006**: 故事走向選擇產出的延續內容與原始故事保持一致的角色和風格
- **SC-007**: Q&A 問題與故事內容高度相關，回答適合目標年齡層理解

## Assumptions

- 本介面為 MVP 測試用途，整合於現有 Voice Lab 前端，透過選單新增功能入口
- 現有的 StoryPal 模組（hackthon-storypal 分支）提供了故事生成引擎、prompt 模板等基礎設施，可複用其核心邏輯
- 測試環境具備穩定的網路連線，可存取 LLM API 和 TTS 服務
- 內容語言固定為繁體中文（台灣用語）
- 父母具備基本的網頁操作能力（點擊、選擇、輸入文字）
- MVP 使用現有 Google OAuth 認證機制，由現場工作人員以自己的帳號登入後操作介面供父母體驗
- TTS 語音選項使用系統已整合的 TTS 服務提供者
- 預設選項列表（價值觀、情緒認知）為固定清單，MVP 階段不提供自訂擴充

## Scope Boundaries

**In Scope**:
- 父母端的簡易輸入介面
- AI 故事/兒歌內容生成
- 內容預覽與確認流程
- TTS 音頻生成與播放
- 故事走向選擇（分支故事）
- 故事 Q&A 互動問答

**Out of Scope**:
- 兒童端專用介面（孩子透過音箱聆聽，不直接操作介面）
- 即時語音互動（即時對話功能由 Magic DJ Controller 處理）
- 背景音樂自動配置（MVP 專注於語音內容）
- 內容收藏/歷史管理（MVP 為一次性體驗流程）
- 多語言支援（僅支援繁體中文）
- 離線使用
- 音頻下載或分享功能
